<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CondoSaas - Login Seguro</title>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root { --primary: #2E7D32; --bg: #f5f5f5; --white: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: var(--bg); color: #333; padding-bottom: 80px; min-height: 100vh; }
        
        /* Layout Geral */
        .app-bar { background: var(--primary); color: white; padding: 16px; position: sticky; top: 0; z-index: 100; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .app-title { font-size: 1.2rem; font-weight: 500; margin-left: 12px; flex: 1; }
        .container { max-width: 1000px; margin: 16px auto; padding: 0 16px; }
        
        /* Cards & UI */
        .card { background: var(--white); border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .btn { padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-danger { background: transparent; border: 1px solid #D32F2F; color: #D32F2F; }
        
        /* Login Screen */
        .login-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; padding: 20px; }
        .login-card { width: 100%; max-width: 400px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .login-header { text-align: center; margin-bottom: 24px; }
        .login-header i { font-size: 48px; color: var(--primary); }
        
        /* Forms */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 0.9rem; color: #555; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; transition: border 0.2s; }
        .form-control:focus { border-color: var(--primary); outline: none; }
        
        /* Calendário e Outros (Mesmos do anterior) */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .week-day { text-align: center; font-size: 0.8rem; color: #666; padding: 8px 0; }
        .day-cell { aspect-ratio: 1; background: #fff; border: 1px solid #eee; border-radius: 4px; display: flex; flex-direction: column; padding: 4px; cursor: pointer; position: relative; }
        .day-cell.today { border: 2px solid var(--primary); }
        .day-cell:hover { background: #f0f0f0; }
        .day-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--primary); margin: 2px; }
        .dots-container { display: flex; flex-wrap: wrap; gap: 2px; margin-top: 4px; }
        .day-number { font-size: 0.9rem; font-weight: bold; }
        
        /* Toasts */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #333; color: white; padding: 12px 20px; border-radius: 4px; animation: slideIn 0.3s; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .toast.success { border-left: 4px solid #4CAF50; }
        .toast.error { border-left: 4px solid #F44336; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* Utilitários */
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; text-transform: uppercase; font-weight: bold; }
        .badge.pending { background: #E3F2FD; color: #1976D2; }
        .badge.approved { background: #E8F5E9; color: #2E7D32; }
        .badge.rejected { background: #FFEBEE; color: #C62828; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .modal-content { background: white; padding: 24px; border-radius: 8px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; height: 60px; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 90; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #999; font-size: 0.7rem; cursor: pointer; }
        .nav-item.active { color: var(--primary); transform: translateY(-2px); }
        .nav-item i { font-size: 24px; margin-bottom: 2px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="app">
        <div class="toast-container">
            <div v-for="(t, i) in toasts" :key="i" class="toast" :class="t.type">
                <i class="material-icons">{{ t.type === 'success' ? 'check_circle' : 'error' }}</i>
                {{ t.message }}
            </div>
        </div>

        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <i class="material-icons">apartment</i>
                    <h2>CondoSaas</h2>
                    <p style="color: #666; font-size: 0.9rem;">{{ isRegistering ? 'Crie sua conta' : 'Acesse seu condomínio' }}</p>
                </div>

                <form @submit.prevent="handleAuth">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" v-model="authForm.email" class="form-control" required placeholder="seu@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" v-model="authForm.password" class="form-control" required placeholder="******" minlength="6">
                    </div>

                    <div v-if="isRegistering">
                        <div class="form-group">
                            <label class="form-label">Nome Completo</label>
                            <input type="text" v-model="authForm.name" class="form-control" required placeholder="Ex: João Silva">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Apartamento / Bloco</label>
                            <input type="text" v-model="authForm.apartment" class="form-control" required placeholder="Ex: 101 Bloco A">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Perfil de Acesso</label>
                            <select v-model="authForm.type" class="form-control">
                                <option value="resident">Morador</option>
                                <option value="syndic">Síndico (Admin)</option>
                            </select>
                            <small style="color: #888; font-size: 0.8rem;">*Para testes, você pode escolher Síndico.</small>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;" :disabled="loading">
                        <span v-if="loading">Carregando...</span>
                        <span v-else>{{ isRegistering ? 'Criar Conta' : 'Entrar' }}</span>
                    </button>
                </form>

                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <button class="btn btn-outline" @click="isRegistering = !isRegistering" style="font-size: 0.9rem; border: none;">
                        {{ isRegistering ? 'Já tem conta? Faça Login' : 'Não tem conta? Cadastre-se' }}
                    </button>
                </div>
            </div>
        </div>

        <div v-else>
            <div class="app-bar">
                <i class="material-icons">apartment</i>
                <span class="app-title">CondoSaas</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="text-align: right; font-size: 0.8rem; line-height: 1.2;">
                        <div>{{ currentUser.name }}</div>
                        <div style="opacity: 0.8;">{{ currentUser.type === 'syndic' ? 'Síndico' : currentUser.apartment }}</div>
                    </div>
                    <button class="btn" style="background: rgba(255,255,255,0.2); padding: 6px;" @click="logout" title="Sair">
                        <i class="material-icons">logout</i>
                    </button>
                </div>
            </div>

            <div class="container">
                <div v-if="currentView === 'calendar'">
                    <div class="card">
                        <div class="calendar-header">
                            <button class="btn btn-outline" @click="changeMonth(-1)"><i class="material-icons">chevron_left</i></button>
                            <h3 style="text-transform: capitalize;">{{ monthLabel }}</h3>
                            <button class="btn btn-outline" @click="changeMonth(1)"><i class="material-icons">chevron_right</i></button>
                        </div>
                        <div class="calendar-grid">
                            <div class="week-day" v-for="d in ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb']">{{ d }}</div>
                            <div v-for="n in paddingDays" :key="'pad-'+n" class="day-cell empty"></div>
                            <div v-for="day in daysInMonth" :key="day" class="day-cell" :class="{ 'today': isToday(day) }" @click="selectDate(day)">
                                <span class="day-number">{{ day }}</span>
                                <div class="dots-container">
                                    <div v-for="res in getReservationsForDay(day)" :key="res.id" class="day-dot" :style="{ background: getStatusColor(res.status) }"></div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; font-size: 0.8rem; color: #666; display: flex; gap: 15px; justify-content: center;">
                            <span style="display:flex; align-items:center;"><div class="day-dot" style="background:#4CAF50; margin-right:4px;"></div> Aprovado</span>
                            <span style="display:flex; align-items:center;"><div class="day-dot" style="background:#2196F3; margin-right:4px;"></div> Pendente</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Espaços Disponíveis</h3>
                        <div v-for="space in spaces" :key="space.id" style="border-bottom: 1px solid #eee; padding: 15px 0; display: flex; gap: 15px; align-items: center;">
                            <div :style="{backgroundImage: 'url('+space.image+')'}" style="width: 60px; height: 60px; background-size: cover; border-radius: 8px;"></div>
                            <div style="flex: 1;">
                                <strong>{{ space.name }}</strong>
                                <div style="font-size: 0.9rem; color: #666;">Max: {{ space.capacity }} • R$ {{ space.hourlyRate }}/h</div>
                            </div>
                            <button class="btn btn-primary" @click="openBookingModal(space)">Reservar</button>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'reservations'">
                    <h2>Minhas Reservas</h2>
                    <div v-if="myReservations.length === 0" style="text-align: center; padding: 40px; color: #999;">
                        <i class="material-icons" style="font-size: 48px;">event_busy</i>
                        <p>Nenhuma reserva encontrada.</p>
                    </div>
                    <div v-for="res in myReservations" :key="res.id" class="card">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>{{ getSpaceName(res.spaceId) }}</strong>
                            <span class="badge" :class="res.status">{{ translateStatus(res.status) }}</span>
                        </div>
                        <p style="color: #666; font-size: 0.9rem;">{{ formatDate(res.date) }} às {{ res.time }}</p>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button v-if="res.status === 'approved'" class="btn btn-outline" @click="generateReceipt(res)"><i class="material-icons">description</i> Comprovante</button>
                            <button v-if="res.status === 'pending'" class="btn btn-danger" @click="deleteReservation(res.id)">Cancelar</button>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'admin'">
                    <h2>Painel do Síndico</h2>
                    <div v-if="currentUser.type !== 'syndic'" class="card" style="text-align: center; color: #D32F2F;">
                        <i class="material-icons">block</i> Acesso negado. Apenas síndicos.
                    </div>
                    <div v-else>
                        <div class="card">
                            <div style="display: flex; gap: 20px; text-align: center;">
                                <div style="flex: 1;">
                                    <div style="font-size: 2rem; color: #2196F3; font-weight: bold;">{{ pendingReservations.length }}</div>
                                    <div style="font-size: 0.8rem; text-transform: uppercase;">Pendentes</div>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 2rem; color: #4CAF50; font-weight: bold;">{{ approvedReservations.length }}</div>
                                    <div style="font-size: 0.8rem; text-transform: uppercase;">Aprovadas</div>
                                </div>
                            </div>
                        </div>

                        <h3>Solicitações</h3>
                        <div v-if="pendingReservations.length === 0" style="color: #999;">Nenhuma pendência.</div>
                        <div v-for="res in pendingReservations" :key="res.id" class="card" style="border-left: 4px solid #2196F3;">
                            <strong>{{ getSpaceName(res.spaceId) }}</strong>
                            <div style="font-size: 0.9rem; color: #666;">
                                <i class="material-icons" style="font-size: 14px;">person</i> {{ res.userName || 'Morador' }}
                                <br>
                                <i class="material-icons" style="font-size: 14px;">calendar_today</i> {{ formatDate(res.date) }} - {{ res.time }}
                            </div>
                            <div style="margin-top: 10px; display: flex; gap: 10px;">
                                <button class="btn btn-primary" style="flex: 1;" @click="updateStatus(res.id, 'approved')">Aprovar</button>
                                <button class="btn btn-danger" style="flex: 1;" @click="updateStatus(res.id, 'rejected')">Rejeitar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bottom-nav">
                <div class="nav-item" :class="{active: currentView === 'calendar'}" @click="currentView = 'calendar'">
                    <i class="material-icons">calendar_month</i>Início
                </div>
                <div class="nav-item" :class="{active: currentView === 'reservations'}" @click="currentView = 'reservations'">
                    <i class="material-icons">receipt_long</i>Reservas
                </div>
                <div v-if="currentUser.type === 'syndic'" class="nav-item" :class="{active: currentView === 'admin'}" @click="currentView = 'admin'">
                    <i class="material-icons">verified_user</i>Síndico
                </div>
            </div>
        </div>

        <div class="modal-overlay" v-if="showModal" @click.self="showModal = false">
            <div class="modal-content">
                <h3>Reservar {{ selectedSpace?.name }}</h3>
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" v-model="form.date" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Horário</label>
                    <select v-model="form.time" class="form-control">
                        <option>08:00 - 12:00</option>
                        <option>13:00 - 17:00</option>
                        <option>18:00 - 22:00</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Convidados</label>
                    <input type="number" v-model="form.guests" class="form-control" :max="selectedSpace?.capacity">
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-outline" @click="showModal = false">Cancelar</button>
                    <button class="btn btn-primary" @click="confirmBooking" :disabled="loading">
                        {{ loading ? 'Enviando...' : 'Confirmar' }}
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { createApp, ref, computed, onMounted } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
        
        // FIREBASE IMPORTS
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // CONFIGURAÇÃO (SUAS CHAVES)
        const firebaseConfig = {
            apiKey: "AIzaSyDeWvVtINqz07UK-iCZwG8-rfBJN7insDM",
            authDomain: "condosaas-app.firebaseapp.com",
            projectId: "condosaas-app",
            storageBucket: "condosaas-app.firebasestorage.app",
            messagingSenderId: "1094942324011",
            appId: "1:1094942324011:web:49293ce94269e71807416e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        createApp({
            setup() {
                // Estado Global
                const currentView = ref('calendar');
                const currentUser = ref(null);
                const loading = ref(false);
                const toasts = ref([]);
                const reservations = ref([]);
                
                // Auth Form State
                const isRegistering = ref(false);
                const authForm = ref({ email: '', password: '', name: '', apartment: '', type: 'resident' });

                // Dados Estáticos
                const spaces = ref([
                    { id: 'esp_1', name: 'Salão de Festas', capacity: 50, hourlyRate: 80, image: 'https://images.unsplash.com/photo-1519167758481-83f550bb49b3?w=200' },
                    { id: 'esp_2', name: 'Churrasqueira', capacity: 20, hourlyRate: 30, image: 'https://images.unsplash.com/photo-1555244162-803834f70033?w=200' },
                    { id: 'esp_3', name: 'Quadra', capacity: 30, hourlyRate: 15, image: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200' }
                ]);

                // --- SISTEMA DE AUTENTICAÇÃO ---
                
                // Monitora estado do login (Persistência)
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // Se logou no Firebase Auth, busca os dados extras no Firestore
                        try {
                            const userDoc = await getDoc(doc(db, "users", user.uid));
                            if (userDoc.exists()) {
                                currentUser.value = { uid: user.uid, email: user.email, ...userDoc.data() };
                            } else {
                                // Fallback se não achar documento
                                currentUser.value = { uid: user.uid, email: user.email, name: 'Usuário', type: 'resident' };
                            }
                            initRealtimeData(); // Começa a ouvir as reservas
                        } catch (e) {
                            console.error("Erro ao buscar perfil", e);
                        }
                    } else {
                        currentUser.value = null;
                        reservations.value = []; // Limpa dados locais
                    }
                });

                const handleAuth = async () => {
                    loading.value = true;
                    try {
                        if (isRegistering.value) {
                            // 1. Criar usuário no Auth
                            const userCredential = await createUserWithEmailAndPassword(auth, authForm.value.email, authForm.value.password);
                            const user = userCredential.user;
                            
                            // 2. Criar documento de perfil no Firestore (Para salvar apto e tipo)
                            await setDoc(doc(db, "users", user.uid), {
                                name: authForm.value.name,
                                apartment: authForm.value.apartment,
                                type: authForm.value.type, // 'resident' ou 'syndic'
                                email: authForm.value.email
                            });
                            
                            showToast("Conta criada com sucesso!", "success");
                        } else {
                            // Login Simples
                            await signInWithEmailAndPassword(auth, authForm.value.email, authForm.value.password);
                            showToast("Bem-vindo de volta!");
                        }
                    } catch (e) {
                        let msg = "Erro na autenticação.";
                        if(e.code === 'auth/invalid-credential') msg = "E-mail ou senha incorretos.";
                        if(e.code === 'auth/email-already-in-use') msg = "E-mail já cadastrado.";
                        if(e.code === 'auth/weak-password') msg = "Senha muito fraca (min 6 digitos).";
                        showToast(msg, "error");
                        console.error(e);
                    } finally {
                        loading.value = false;
                    }
                };

                const logout = async () => {
                    await signOut(auth);
                    currentView.value = 'calendar'; // Reseta view
                    showToast("Você saiu do sistema.");
                };

                // --- DADOS EM TEMPO REAL ---
                const initRealtimeData = () => {
                    const q = query(collection(db, "reservations"), orderBy("date"));
                    onSnapshot(q, (snapshot) => {
                        reservations.value = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    });
                };

                // --- LÓGICA DE NEGÓCIO (Mesma anterior) ---
                
                // Toast
                const showToast = (message, type = 'success') => {
                    toasts.value.push({ message, type });
                    setTimeout(() => toasts.value.shift(), 3000);
                };

                // Reservas
                const showModal = ref(false);
                const selectedSpace = ref(null);
                const form = ref({ date: '', time: '13:00 - 17:00', guests: 10 });

                const openBookingModal = (space) => {
                    selectedSpace.value = space;
                    const d = new Date();
                    form.value.date = d.toISOString().split('T')[0];
                    showModal.value = true;
                };

                const confirmBooking = async () => {
                    if (!form.value.date) return showToast("Data inválida", "error");
                    
                    // Validação de conflito
                    const conflict = reservations.value.find(r => 
                        r.spaceId === selectedSpace.value.id && 
                        r.date === form.value.date && 
                        r.status === 'approved'
                    );
                    if(conflict) return showToast("Data indisponível!", "error");

                    loading.value = true;
                    try {
                        await addDoc(collection(db, "reservations"), {
                            spaceId: selectedSpace.value.id,
                            userId: currentUser.value.uid, // Usa UID real do Auth
                            userName: currentUser.value.name, // Nome real do Firestore
                            date: form.value.date,
                            time: form.value.time,
                            guests: form.value.guests,
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        });
                        showToast("Solicitação enviada!");
                        showModal.value = false;
                        currentView.value = 'reservations';
                    } catch (e) {
                        showToast("Erro ao salvar.", "error");
                    } finally {
                        loading.value = false;
                    }
                };

                const updateStatus = async (id, status) => {
                    try {
                        await updateDoc(doc(db, "reservations", id), { status });
                        showToast(`Status atualizado para ${status}`);
                    } catch (e) { showToast("Erro ao atualizar", "error"); }
                };

                const deleteReservation = async (id) => {
                    if(!confirm("Cancelar reserva?")) return;
                    try {
                        await deleteDoc(doc(db, "reservations", id));
                        showToast("Reserva cancelada");
                    } catch (e) { showToast("Erro ao cancelar", "error"); }
                };

                // Computeds e Helpers
                const myReservations = computed(() => reservations.value.filter(r => r.userId === currentUser.value?.uid).sort((a,b) => new Date(b.date) - new Date(a.date)));
                const pendingReservations = computed(() => reservations.value.filter(r => r.status === 'pending'));
                const approvedReservations = computed(() => reservations.value.filter(r => r.status === 'approved'));

                // Calendário Utils
                const currentDate = ref(new Date());
                const monthLabel = computed(() => currentDate.value.toLocaleString('pt-BR', { month: 'long', year: 'numeric' }));
                const daysInMonth = computed(() => new Date(currentDate.value.getFullYear(), currentDate.value.getMonth() + 1, 0).getDate());
                const paddingDays = computed(() => new Date(currentDate.value.getFullYear(), currentDate.value.getMonth(), 1).getDay());
                
                const getReservationsForDay = (day) => {
                    const y = currentDate.value.getFullYear();
                    const m = String(currentDate.value.getMonth()+1).padStart(2,'0');
                    const d = String(day).padStart(2,'0');
                    return reservations.value.filter(r => r.date === `${y}-${m}-${d}` && r.status !== 'rejected');
                };
                
                const changeMonth = (d) => currentDate.value = new Date(currentDate.value.setMonth(currentDate.value.getMonth() + d));
                const selectDate = (day) => {
                    const y = currentDate.value.getFullYear();
                    const m = String(currentDate.value.getMonth()+1).padStart(2,'0');
                    const d = String(day).padStart(2,'0');
                    form.value.date = `${y}-${m}-${d}`;
                    // Pode abrir modal aqui se quiser
                };

                // PDF
                const generateReceipt = (res) => {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.text("Comprovante Oficial", 20, 20);
                    doc.text(`Reserva: ${res.id}`, 20, 30);
                    doc.text(`Espaço: ${getSpaceName(res.spaceId)}`, 20, 40);
                    doc.text(`Data: ${formatDate(res.date)}`, 20, 50);
                    doc.save("comprovante.pdf");
                };

                // Formatters
                const getSpaceName = (id) => spaces.value.find(s => s.id === id)?.name || 'Espaço';
                const getStatusColor = (s) => s === 'approved' ? '#4CAF50' : s === 'pending' ? '#2196F3' : '#F44336';
                const translateStatus = (s) => ({'approved':'Aprovada','pending':'Pendente','rejected':'Rejeitada'})[s] || s;
                const formatDate = (d) => d ? d.split('-').reverse().join('/') : '';
                const isToday = (day) => {
                    const t = new Date();
                    return day === t.getDate() && currentDate.value.getMonth() === t.getMonth();
                };

                return {
                    currentUser, isRegistering, authForm, handleAuth, logout, loading,
                    currentView, spaces, showModal, form, toasts, reservations,
                    monthLabel, daysInMonth, paddingDays,
                    myReservations, pendingReservations, approvedReservations,
                    changeMonth, selectDate, getReservationsForDay, openBookingModal, confirmBooking,
                    updateStatus, deleteReservation, generateReceipt, getSpaceName, getStatusColor, translateStatus, formatDate, isToday
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
